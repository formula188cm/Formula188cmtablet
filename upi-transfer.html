<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Transfer - Formula188cm</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body style="background:#fff;">
    <header>
        <nav>
            <div class="logo">Formula188cm</div>
            <a href="payment.html" class="back-btn" style="color:#000;font-size:1.1rem;text-decoration:none;"><i class="fas fa-arrow-left"></i> Back</a>
        </nav>
    </header>
    <main class="checkout-container" style="max-width:420px;margin:60px auto 0 auto;">
        <div class="order-summary-top" style="margin-bottom:18px;background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.07);padding:1.2rem 1.2rem 1rem 1.2rem;display:flex;flex-direction:column;gap:0.5rem;">
            <div class="summary-item" style="display:flex;justify-content:space-between;font-size:1.08rem;">
                <span style="color:#444;">Quantity</span>
                <span id="summary-qty" style="font-weight:600;color:#000;">1</span>
            </div>
            <div class="summary-item total" style="display:flex;justify-content:space-between;font-size:1.13rem;margin-top:0.5rem;font-weight:700;">
                <span style="color:#222;">Total</span>
                <span id="summary-total" style="color:#000;">₹1,099.00</span>
            </div>
        </div>
        <div class="upi-card" style="background:#fff;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.10);padding:32px 24px 24px 24px;">
            <h2 style="color:#000;text-align:center;margin-bottom:18px;">UPI Transfer</h2>
            <div class="upi-details">
                <div class="detail-row" style="justify-content:space-between;align-items:center;font-size:1.08rem;">
                    <!-- <span style="font-weight:600;">UPI ID:</span> -->
                    <span id="upi-id" style="font-family:monospace;font-size:1.08rem;">ayushyaduvanshi56441@okicici</span>
                    <button class="copy-btn" data-copy="ayushyaduvanshi56441@okicici" style="margin-left:10px;"><i class="fas fa-copy"></i></button>
                </div>
                <div class="detail-row" style="justify-content:center;"><canvas id="upi-qr-canvas" style="max-width:160px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);"></canvas></div>
            </div>
            <div class="important-note" style="margin-top:18px;">
                <strong>Note:</strong> After payment, please send the payment screenshot or details to WhatsApp: <a href="https://wa.me/918989252740" target="_blank" style="color:#000;">8989252740</a> or Email: <a href="mailto:formula188cm@gmail.com" style="color:#000;">formula188cm@gmail.com</a>
            </div>
            <ul class="important-points" style="margin:18px 0 16px 0;">
                <li>Double-check UPI ID before paying.</li>
                <li>Save your payment receipt for reference.</li>
                <li>Payments are non-refundable once processed.</li>
                <li>Do not share your payment details with anyone else.</li>
            </ul>
            <button class="complete-order-btn" id="upi-paid-btn" style="background:#000;color:#fff;">I Have Paid Now</button>
            <div class="help-link" style="margin-top:18px;text-align:center;">
                <a href="https://wa.me/918989252740" target="_blank" style="color:#25d366;"><i class="fab fa-whatsapp"></i> Need help? Chat on WhatsApp</a>
            </div>
        </div>
    </main>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Generate UPI QR code
        const upiId = 'ayushyaduvanshi56441@okicici';
        const payeeName = 'Ayush Kumar';
        const amount = '1099';
        const transactionRef = 'FORMULA188CM';
        
        // Create UPI payment string
        const upiString = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR&tr=${transactionRef}`;
        
        // Generate QR code using QRious
        const qr = new QRious({
            element: document.getElementById('upi-qr-canvas'),
            value: upiString,
            size: 200,
            background: 'white',
            foreground: 'black'
        });

        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const val = btn.getAttribute('data-copy');
                navigator.clipboard.writeText(val);
                btn.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy"></i>';
                }, 1200);
            });
        });
        // Add UPI payment button functionality
        const upiPayBtn = document.createElement('button');
        upiPayBtn.textContent = 'Pay with UPI App';
        upiPayBtn.style.cssText = 'display:inline-block;margin:12px 8px;padding:12px 24px;font-size:1.08rem;font-weight:600;background:#25d366;color:#fff;border-radius:8px;border:none;cursor:pointer;';
        
        // Add PhonePe specific button
        const phonepePayBtn = document.createElement('button');
        phonepePayBtn.textContent = 'Pay with PhonePe';
        phonepePayBtn.style.cssText = 'display:inline-block;margin:12px 8px;padding:12px 24px;font-size:1.08rem;font-weight:600;background:#5f259f;color:#fff;border-radius:8px;border:none;cursor:pointer;';
        upiPayBtn.addEventListener('click', function() {
            const upiId = 'ayushyaduvanshi56441@okicici';
            const amount = '1099';
            const payeeName = 'Ayush Kumar';
            const transactionRef = 'FORMULA188CM';
            
            // Detect user agent to provide PhonePe-specific links
            const userAgent = navigator.userAgent.toLowerCase();
            const isAndroid = userAgent.includes('android');
            const isIOS = userAgent.includes('iphone') || userAgent.includes('ipad');
            
            // Try multiple UPI deep link formats with PhonePe-specific formats
            const upiLinks = [
                // Standard UPI format
                `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR&tr=${transactionRef}`,
                // PhonePe specific format
                `phonepe://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR&tr=${transactionRef}`,
                // Alternative PhonePe format
                `phonepe://pay?pa=${upiId}&am=${amount}&cu=INR`,
                // Standard without transaction ref
                `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`,
                // Minimal format
                `upi://pay?pa=${upiId}&am=${amount}&cu=INR`,
                // Very minimal
                `upi://pay?pa=${upiId}&am=${amount}`,
                // PhonePe minimal
                `phonepe://pay?pa=${upiId}&am=${amount}`
            ];
            
            let linkIndex = 0;
            const tryNextLink = () => {
                if (linkIndex < upiLinks.length) {
                    const link = upiLinks[linkIndex];
                    const timeout = setTimeout(() => {
                        linkIndex++;
                        tryNextLink();
                    }, 2000);
                    
                    window.location.href = link;
                    
                    // Clear timeout if user navigates away
                    window.addEventListener('beforeunload', () => clearTimeout(timeout));
                } else {
                    // Enhanced fallback with PhonePe-specific instructions
                    const fallbackMessage = `UPI app could not be opened automatically. Please try one of these methods:

Method 1 - Manual UPI Entry:
1. Open your UPI app (PhonePe/Google Pay/Paytm)
2. Enter UPI ID: ${upiId}
3. Enter amount: ₹${amount}
4. Complete the payment

Method 2 - For PhonePe specifically:
1. Open PhonePe app
2. Go to "Send Money"
3. Enter UPI ID: ${upiId}
4. Enter amount: ₹${amount}
5. Add note: ${transactionRef}
6. Complete payment

Method 3 - Use QR Code:
Scan the QR code above with your UPI app

Method 4 - Contact Support:
WhatsApp: 8989252740 for assistance`;
                    
                    alert(fallbackMessage);
                }
            };
            
            tryNextLink();
        });
        
        // PhonePe specific button handler
        phonepePayBtn.addEventListener('click', function() {
            const upiId = 'ayushyaduvanshi56441@okicici';
            const amount = '1099';
            const payeeName = 'Ayush Kumar';
            const transactionRef = 'FORMULA188CM';
            
            // PhonePe specific deep link formats
            const phonepeLinks = [
                // PhonePe direct format
                `phonepe://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR&tr=${transactionRef}`,
                // PhonePe with minimal parameters
                `phonepe://pay?pa=${upiId}&am=${amount}&cu=INR`,
                // PhonePe with just UPI ID and amount
                `phonepe://pay?pa=${upiId}&am=${amount}`,
                // Alternative PhonePe format
                `phonepe://send?pa=${upiId}&am=${amount}`,
                // Standard UPI format as fallback
                `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR&tr=${transactionRef}`
            ];
            
            let linkIndex = 0;
            const tryNextLink = () => {
                if (linkIndex < phonepeLinks.length) {
                    const link = phonepeLinks[linkIndex];
                    const timeout = setTimeout(() => {
                        linkIndex++;
                        tryNextLink();
                    }, 2000);
                    
                    window.location.href = link;
                    
                    // Clear timeout if user navigates away
                    window.addEventListener('beforeunload', () => clearTimeout(timeout));
                } else {
                    // PhonePe specific fallback instructions
                    const phonepeMessage = `PhonePe could not be opened automatically. Please try these PhonePe-specific methods:

Method 1 - Direct PhonePe Entry:
1. Open PhonePe app
2. Tap "Send Money"
3. Enter UPI ID: ${upiId}
4. Enter amount: ₹${amount}
5. Add note: ${transactionRef}
6. Complete payment

Method 2 - PhonePe QR Scanner:
1. Open PhonePe app
2. Tap "Scan & Pay"
3. Scan the QR code above

Method 3 - PhonePe Mobile Number:
1. Open PhonePe app
2. Go to "Send Money"
3. Enter mobile number: 8989252740
4. Enter amount: ₹${amount}
5. Complete payment

Method 4 - Contact Support:
WhatsApp: 8989252740 for assistance`;
                    
                    alert(phonepeMessage);
                }
            };
            
            tryNextLink();
        });
        
        // Insert the buttons before the "I Have Paid Now" button
        const upiDetails = document.querySelector('.upi-details');
        upiDetails.appendChild(upiPayBtn);
        upiDetails.appendChild(phonepePayBtn);

        document.getElementById('upi-paid-btn').addEventListener('click', async function() {
            // No Sheet7 submission here anymore
            alert('Thank you for your payment! Please send the payment screenshot to WhatsApp: 8989252740 or Email: formula188cm@gmail.com');
            window.location.href = 'thank-you.html';
        });
        // Update summary dynamically from sessionStorage
        const orderDetails = JSON.parse(sessionStorage.getItem('orderDetails'));
        const qtyEl = document.getElementById('summary-qty');
        const totalEl = document.getElementById('summary-total');
        const basePrice = 1099;
        const codPrice = 1299;
        let quantity = 1;
        let paymentMethod = 'online';
        if (orderDetails) {
            quantity = parseInt(orderDetails.quantity) || 1;
            paymentMethod = orderDetails.paymentMethod || 'online';
        }
        const pricePerUnit = paymentMethod === 'cod' ? codPrice : basePrice;
        const total = pricePerUnit * quantity;
        qtyEl.textContent = quantity;
        totalEl.textContent = `₹${total.toLocaleString()}.00`;
    });
    </script>
</body>
</html> 